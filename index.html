<!DOCTYPE html>
<html lang="en">
  <head>
    <!--
      Reading this? Looking for an awesome software developer? You might want to check out
      sdufresne.info/cv.html :-)

      ... or just email me. I never update my cv.
    -->
    <title>Stefan du Fresne - Software Developer, Imagineer and general human</title>
    <meta name="description" content="Personal homepage of Stefan du Fresne, software developer aka software engineer aka code craftsman aka software imagineer." />
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style type="text/css">

      html {
        font-family: -apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Noto,Roboto,"Helvetica Neue","Helvetica",Arial,sans-serif;
      }

      .numbers {
        font-family: monospace, monospace;
      }

      .night-mode {
        background-color: #222;
        color: #ddd;
      }

      /* normal screens */
      #avatar {
        max-width: 100%;
      }

      #site-wrapper {
        max-width: 1280px;
        font-size: 200%;
        line-height: 1.4;
        padding-right: 1em;
        padding-left: 1em;
        margin: 0 auto;
      }

      #spiel {
        float: left;
        width: 60%;
      }
      #contact {
        width: 30%;
        float: right;
      }

      /* anti-spam */
      .email-address {
        unicode-bidi: bidi-override;
        direction: rtl;
      }

      /* actual styling */
      body {
        color: #333;
      }

      .greeting {
        line-height: 2ex;
      }

      .clickable {
        cursor: pointer;
      }

      #spiel .clickable,
      #spiel a {
        display: inline-block;
        transition: all .1s;
      }

      .clickable, a, a:visited, a:hover, a:active {
        font-weight: bold;
        text-decoration: none;
        color: #333;
        background-color: #FFEFEF;
        margin: -0.125em;
        padding: 0.125em;
      }
      #spiel .clickable:hover,
      #spiel a:hover {
        color: #FFEFEF;
        background-color: #A00;

        -webkit-transform: rotateZ(-1deg);
        -ms-transform: rotateZ(-1deg);
        transform: rotateZ(-1deg);
      }

      .smash {
        transition: all .1s;

        -webkit-transform: rotateZ(1deg) !important;
        -ms-transform: rotateZ(1deg) !important;
        transform: rotateZ(1deg) !important;
      }

      @media (pointer: coarse) {
        #spiel .clickable:hover,
        #spiel a:hover {
          /* TODO: Do I have to repeat myself here? */
          color: #333;
          background-color: #FFEFEF;

          -webkit-transform: initial;
          -ms-transform: initial;
          transform: initial;
        }
      }

      #contact a,
      #contact a:visited,
      #contact a:hover,
      #contact a:active {
        font-weight: inherit;
        color: #406CB6;
        background-color: inherit;
      }
      #contact a:hover {
        color: red;
      }

      #contact {
        font-size: 80%;
        line-height: initial;
      }

      #contact ul {
        padding-left: 0;
      }

      #contact li {
        list-style-type: none;
        overflow: hidden;
      }

      #minor-contacts {
        font-size: 80%;
      }

      /* smaller screens */
      @media screen and (max-width: 760px) {
        #avatar {
          display: none;
        }

        #site-wrapper {
          padding: 0;
          margin: 0;
          padding-top: 0.5em;
          overflow: auto;
          position: relative;
        }
        #contact {
          float: none;
          width: 100%;
        }
        #major-contacts {
          border-top: solid #eee;
          padding-left: 1em !important;
          margin: 0;
          line-height: 1.5;
        }
        #major-contacts li {
          display: inline-flex;
          font-size: 110%;
          padding: 0.5em;
          margin: 0.5em;
          background-color: #FFEFEF;
        }
        #major-contacts a,
        #major-contacts a:visited,
        #major-contacts a:hover,
        #major-contacts a:active {
          font-weight: bold;
          text-decoration: none;
          color: #333;
          background-color: #FFEFEF;
          margin: -0.125em;
          padding: 0.125em;
        }

        #minor-contacts {
          margin: 0;
          line-height: 1.5;
        }
        #sigh {
          clear: both;
        }
        #spiel {
          float: none;
          width: inherit;
          margin: 0.5em;
          margin-top: 0;
          padding: 1em;
          padding-top: 0;
        }
      }
      /* Desktop font sizes */
      @media screen and (max-width: 1280px) {
        #site-wrapper {
          font-size: 150%;
        }
      }
      @media screen and (max-width: 900px) {
        #site-wrapper {
          font-size: 135%;
        }
      }
      /* Now mobile sheet */
      @media screen and (max-width: 760px) {
        #site-wrapper {
          font-size: 150%;
        }
      }
      @media screen and (max-width: 600px) {
        #site-wrapper {
          font-size: 110%;
        }
      }
      @media screen and (max-width: 420px) {
        #site-wrapper {
          font-size: 100%;
        }
      }
      @media screen and (max-width: 380px) {
        #site-wrapper {
          font-size: 95%;
        }
      }
      @media screen and (max-width: 360px) {
        #site-wrapper {
          font-size: 85%;
        }
      }
    </style>
  </head>
  <body style="margin: 0; padding: 0;">
    <main id="site-wrapper">
      <div id="spiel"><!-- ;-) -->
        <h1 class="greeting" id="greeting">Hello,</h1>
        <h2 class="greeting">My name is Stefan du Fresne</h2>
        <p>I'm <span id="aan">a</span> <span id="job-title">software developer</span> from New Zealand. I currently live in London.</p>
        <p>Over the last <span id="career-length">few years</span> I've helped to build a reasonably large amount of software. Some of it works!</p>
        <p>Currently I'm working with <a href="http://medicmobile.org/team">these</a> delightful humans to build open source health tooling to improve outcomes in under-served communities.</p>
        <p>We use Angular, Node and all that good stuff. Functional programming&mdash;Scala and Clojure especially&mdash;is cool too. Rust is also pretty neat. Whatever works.</p>
        <p>I often go by SCdF on the Internet.</p>
        <p>hmu :-)</p>
      </div>
      <div id="contact">
        <img
          id="avatar"
          alt="Picture of Stefan du Fresne"
          src="./assets/img/actually-me-2019-1x.jpg"
          srcset="./assets/img/actually-me-2019-1x.jpg 1x, ./assets/img/actually-me-2019-2x.jpg 2x">
        <ul id="major-contacts">
          <li>üíå <span class="email-address">ofni.enserfuds@nafets</span></li>
          <li>üîë <a href="https://keybase.io/scdf">Keybase</a></li>
          <li>üë®üèº‚Äçüíª <a href="https://github.com/SCdF/">Github</a></li>
          <li>üê¶ <a href="https://twitter.com/_SCdF_">Twitter</a></li>
          <li>üôà <a href="https://www.linkedin.com/in/stefandufresne">...if you really have to</a></li>
        </ul>

        <!--
        <hr>
        <ul id="minor-contacts">
          <li><a href="http://stackoverflow.com/users/1666/scdf">StackOverflow</a></li>
          <li><a href="https://news.ycombinator.com/user?id=SCdF">HackerNews</a></li>
          <li><a href="https://www.flickr.com/photos/stefandufresne/">Flickr</a></li>
        </ul>
        -->

        <div id="sigh"></div>
      </div>
      <script type="text/javascript">
      /* jshint browser: true */
      (function() {
        'use strict';

        // NB: this code uses all the least exciting improvements to JS, because
        // who can be bothered writing a build pipeline for a single static page,
        // and if we can make it work for everyone we should

        var Utils = function() {
          var jobTitles = [
            'software developer',
            'developer',
            'coder',
            'programmer',
          ];

          var allJobTitles = jobTitles.concat([
            '(defn stefan [] (fn[work] (do-work work)))',
            'architect of your dreams',
            'artisan software sculptor',
            'beard horticulturalist',
            'beard horticulturist',
            'bespoke bit twiddler',
            'big fan of yours',
            'bit herder',
            'blockchain disbeliever',
            'code costermonger',
            'code craftsman',
            'code monkey',
            'code-typhoon',
            'courageous headphone jack',
            'deterministic finite automata',
            'gentle code crooner',
            'good enough dev for government work',
            'greatly enlarged micro-organism',
            'infinite field of flowers',
            'large font aficionado',
            'magnetised needle and a steady hand',
            'monad (which is just a monoid in the category of endofunctors, what\'s the problem?)',
            'monotonic semi-lattice',
            'meme wrangler',
            'non-brogrammer programmer',
            'parametrically polymorphic programmer',
            'rabid archillect fan',
            'reasonable human',
            'software "engineer"',
            'software craftsman',
            'software imagineer',
            'software witch',
            'stackoverflow savant',
            'terrible salsa partner',
            'thoroughly average programmer',
          ]);

          var careerLengths = [
            {
              fn: function() {
                var start = new Date(careerStart),
                    now = new Date();

                var years = now.getYear() - start.getYear();

                start.setFullYear(now.getFullYear());

                if (start.getTime() > now.getTime()) {
                  return years - 1;
                } else {
                  return years;
                }
              },
              title: 'years',
              speed: 'minute'
            },
            {
              fn: function() { return dividedCareerLength(1000); },
              title: 'seconds',
              speed: 'second'
            },
            {
              fn: function() { return dividedCareerLength(86400 * 1000); },
              title: 'moons',
              speed: 'minute'
            },
            {
              fn: function() { return dividedCareerLength(1000 * 60 * 60 * 24 * 52); },
              title: 'dog years',
              speed: 'minute'
            },
            {
              fn: function() { return dividedCareerLength(1000 * 60 * 60 * 24 * 30.4 * 6); },
              title: 'friedmans',
              speed: 'minute'
            },
            {
              fn: function() { return dividedCareerLength(1000 * 60 * 60 * 11.4); },
              title: 'LoTR viewings',
              speed: 'minute'
            },
            {
              fn: function() { return dividedCareerLength(1 / 1000) + Math.round((Math.random() * 1000)); }, // get rid of the boring 000 at the end
              title: 'shakes',
              speed: 'frame'
            },
            {
              fn: function() { return dividedCareerLength(1000 / 60); },
              title: 'jiffies',
              speed: 'frame'
            },
            {
              fn: function() { return dividedCareerLength(5.39 * Math.pow(10, -41)).toPrecision(10); },
              title: 'plancks',
              speed: 'frame'
            },
            {
              fn: function() { return Math.floor(299792.458 * rawCareerLength() / 1000); },
              title: 'light meters',
              speed: 'frame'
            },
            {
              fn: function() {
                var wpm = 320; // apparently
                var wap = 561093;

                var minPerWap = wap / wpm;
                return dividedCareerLength(minPerWap * 60 * 1000);
              },
              title: 'readings of War & Peace'
            }
          ];

          var careerStart = 1139860800000;

          var rawCareerLength = function() {
            return Date.now() - careerStart;
          };

          var dividedCareerLength = function(divisor) {
            return Math.floor(rawCareerLength() / divisor);
          };

          // https://stackoverflow.com/a/2450976/1666
          var shuffle = function(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

              // Pick a remaining element...
              randomIndex = Math.floor(Math.random() * currentIndex);
              currentIndex -= 1;

              // And swap it with the current element.
              temporaryValue = array[currentIndex];
              array[currentIndex] = array[randomIndex];
              array[randomIndex] = temporaryValue;
            }

            return array;
          };

          var LoopingShuffleIterator = function(array, _last) {
            var it;
            var last = _last;

            return {
              next: function() {
                var next = it && it.next();
                if (!next || next.done) {
                  shuffle(array);
                  it = array.values();
                  next = it.next();
                }

                if (next.value === last) {
                  // We don't want double-ups, so skip it
                  next = it.next();
                }

                last = next.value;

                return {value: next.value, done: false};
              }
            }
          };

          var titleIterator, careerLengthIterator;
          var careerAnimationHandle;

          var api = {
            reverse: function(s) { return s.split('').reverse().join(''); },

            // I'm a <XXX> from New Zea‚Ä¶
            title: function(cb) {
              var result;
              if (!titleIterator) {
                // First time show a normal one and prep the silly ones
                titleIterator = LoopingShuffleIterator(allJobTitles);
                result = { display: jobTitles[Math.floor(Math.random() * jobTitles.length)] };
              } else {
                result = { display: titleIterator.next().value };
              }

              if (cb) {
                cb(result);
              } else {
                return result;
              }
            },

            article: function(currentTitle) {
              if (['a', 'e', 'i', 'o', 'u'].indexOf(currentTitle.charAt(0)) >= 0) {
                return 'an';
              } else {
                return 'a';
              }
            },

            careerLength: function(cb) {
              var career;
              if (!careerLengthIterator) {
                career = careerLengths[0];
                careerLengthIterator = LoopingShuffleIterator(careerLengths, career);
              } else {
                career = careerLengthIterator.next().value;
              }

              var result = function() {
                return {
                  display: '<span class="numbers">' + career.fn() + '</span> ' + career.title,
                };
              };

              if (cb) {
                var animate = function() { cb(result()); };

                window.clearInterval(careerAnimationHandle);

                animate();

                if (career.speed === 'frame') {
                  // TODO: it would be nice to use requestAnimationFrame
                  // Unfortunately it's surprisingly hard to call and cancel stabily
                  careerAnimationHandle = window.setInterval(animate, 100);
                } else if (career.speed === 'second') {
                  careerAnimationHandle = window.setInterval(animate, 1000);
                } else {
                  careerAnimationHandle = window.setInterval(animate, 60000);
                }
              } else {
                return result();
              }
            },

            beClickable: function(element, clickFn) {
              element.classList.add('clickable');

              clickFn(function(firstValue) {
                element.innerHTML = firstValue.display;
              });

              element.onmousedown = function(e) {
                e.preventDefault();
              };
              element.onmouseup = function() {
                element.classList.add('smash');
                window.setTimeout(function() {
                  clickFn(function(newValue) {
                    element.innerHTML = newValue.display;
                  });

                  element.classList.remove('smash');
                }, 100);
              };
            }
          };
          return api;
        };

        var utils = Utils();

        document.addEventListener("DOMContentLoaded", function() {
          var greeting = document.getElementById('greeting');
          var hours = new Date().getHours();
          if (hours < 12) {
            greeting.innerHTML = 'Good Morning';
          } else if (hours < 18) {
            greeting.innerHTML = 'Good Afternoon';
          } else {
            greeting.innerHTML = 'Good Evening';
          }

          var emailEl = document.querySelector('.email-address');
          emailEl.innerHTML = '<a href="mailto:' +
            utils.reverse(emailEl.innerHTML) +
            '">'+emailEl.innerHTML+'</a>';

          utils.beClickable(
            document.querySelector('#career-length'),
            utils.careerLength);

          utils.beClickable(
            document.querySelector('#job-title'),
            utils.title);

          var jobTitle = document.querySelector('#job-title');
          var titleArticle = document.querySelector('#aan');

          titleArticle.innerHTML = utils.article(jobTitle.innerHTML);
          // TODO: replace with MutationObserver
          jobTitle.addEventListener ("DOMSubtreeModified", function() {
            if (jobTitle.innerHTML) {
              titleArticle.innerHTML = utils.article(jobTitle.innerHTML);
            }
          });

          document.querySelector('#spiel a').onclick = function() {
            this.className = this.className + ' smash';
          };
        });
      })();
      </script>
    </main>
  </body>
</html>
